# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Screen1:
    Children:
      - RectQuickActionBar1:
          Control: Rectangle@2.3.0
          Properties:
            Height: =88
            Width: =Parent.Width
      - LblAppName1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Color: =App.Theme.Colors.PrimaryForeground
            Height: =88
            PaddingLeft: =0
            Size: =27
            Text: ="Meeting"
            Width: =356
            Wrap: =false
            X: =32
      - IconSendItem1:
          Control: Classic/Icon@2.5.0
          Properties:
            AccessibleLabel: =Self.Tooltip
            Color: =RGBA(255, 255, 255, 1)
            DisabledFill: =RGBA(240, 240, 240, 0.5)
            DisplayMode: =If(Len(Trim(TextMeetingSubject1.Text)) > 0 && !IsEmpty(MyPeople) && !IsBlank(_selectedMeetingTime), DisplayMode.Edit, DisplayMode.Disabled)
            Height: =88
            Icon: =Icon.Send
            OnSelect: |-
              =/*sends a meeting invite if necessary fields are filled out (attendees, subject, meeting time selection)*/
              Set(_myCalendarName, LookUp(Office365Outlook.CalendarGetTables().value, DisplayName = "Calendar").Name);
              Set(_myScheduledMeeting, Office365Outlook.V2CalendarPostItem(_myCalendarName,
               TextMeetingSubject1.Text, Text(DateAdd(DateTimeValue(_selectedMeetingTime.StartTime), -TimeZoneOffset(), TimeUnit.Minutes)),
               Text(DateAdd(DateTimeValue(_selectedMeetingTime.EndTime), -TimeZoneOffset(), TimeUnit.Minutes)),
               {RequiredAttendees:Concat(MyPeople, UserPrincipalName & ";") & _selectedRoom.Address, Body: TextMeetingMessage1.Text, Location: _selectedRoom.Name, Importance: "Normal", ShowAs: "Busy", ResponseRequested: true}));
               Concurrent(
                 Reset(TextMeetingLocation1),
                 Reset(TextMeetingSubject1),
                 Reset(TextMeetingMessage1),
                 Clear(MyPeople),
                 Set(_selectedMeetingTime, Blank()),
                 Set(_selectedRoomList, Blank()),
                 Set(_selectedRoom, Blank()),
                 Set(_roomListSelected, false)
              )
            PaddingBottom: =20
            PaddingLeft: =20
            PaddingRight: =20
            PaddingTop: =20
            PressedFill: =RGBA(255, 255, 255, 0.3)
            TabIndex: =0
            Tooltip: ="Send invite"
            Width: =88
            X: =Parent.Width - Self.Width
      - LblInviteTab1:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =Self.Color
            Color: =If(_showDetails, LblRecipientCount1.Color, RectQuickActionBar1.Fill)
            FocusedBorderThickness: =2
            FontWeight: =If(_showDetails, FontWeight.Normal, FontWeight.Semibold)
            Height: =50
            OnSelect: =Set(_showDetails, false)
            Size: =22
            TabIndex: =0
            Text: ="Invite"
            Tooltip: ="Select to fill out meeting subject, body, and attendees"
            Width: =283
            Wrap: =false
            X: =32
            Y: =RectQuickActionBar1.Height + 16
      - LblScheduleTab1:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =Self.Color
            Color: =If(!_showDetails, LblRecipientCount1.Color, RectQuickActionBar1.Fill)
            FocusedBorderThickness: =2
            FontWeight: =If(!_showDetails, FontWeight.Normal, FontWeight.Semibold)
            Height: =50
            OnSelect: =Set(_showDetails, true)
            Size: =22
            TabIndex: =0
            Text: ="Schedule"
            Tooltip: ="Select to fill out meeting date, duration, and location"
            Width: =283
            Wrap: =false
            X: =LblInviteTab1.X + LblInviteTab1.Width + 3
            Y: =RectQuickActionBar1.Height + 16
      - RectHeaderSep1:
          Control: Rectangle@2.3.0
          Properties:
            Fill: =RGBA(240, 240, 240, 1)
            Height: =2
            Width: =Parent.Width
            Y: =LblInviteTab1.Y + LblInviteTab1.Height + 8
      - RectTabSelect1:
          Control: Rectangle@2.3.0
          Properties:
            Height: =2
            Width: =LblInviteTab1.Width + 3
            X: =If(_showDetails, LblScheduleTab1.X - 1.5, LblInviteTab1.X - 1.5)
            Y: =LblInviteTab1.Y + LblInviteTab1.Height + 8
      - LblRecipientCount1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =50
            Text: ="*Attendees (" &CountRows(MeetingPeopleGallery1.AllItems) & ")"
            Visible: =!_showDetails
            Width: =300
            Wrap: =false
            X: =32
            Y: =RectTabSelect1.Y + RectTabSelect1.Height + 24
      - TextSearchBox1:
          Control: Classic/TextInput@2.3.2
          Properties:
            AccessibleLabel: ="Search people or add email address. At least one recipient is required for a successful submission."
            Default: =""
            HintText: ="Search for people"
            PaddingLeft: =70
            Visible: =!_showDetails
            Width: =Parent.Width - Self.X * 2
            X: =32
            Y: =LblRecipientCount1.Y + LblRecipientCount1.Height + 6
      - SearchIcon1:
          Control: Classic/Icon@2.5.0
          Properties:
            Height: =Self.Width
            Icon: =Icon.Search
            PaddingBottom: =18
            PaddingLeft: =18
            PaddingRight: =18
            PaddingTop: =18
            Tooltip: ="Search"
            Visible: =!_showDetails
            Width: =TextSearchBox1.Height
            X: =TextSearchBox1.X
            Y: =TextSearchBox1.Y
      - AddIcon1:
          Control: Classic/Icon@2.5.0
          Properties:
            Height: =TextSearchBox1.Height
            Icon: =Icon.Add
            OnSelect: |-
              =Collect(MyPeople, {DisplayName: TextSearchBox1.Text, UserPrincipalName: TextSearchBox1.Text});
              Concurrent(
              Reset(TextSearchBox1),
              Set(_showMeetingTimes, false),
              UpdateContext({_loadMeetingTimes: true}),
              Set(_selectedMeetingTime, Blank()),
              Set(_selectedRoom, Blank()),
              Set(_roomListSelected, false),
              /*
              Uses Office365 Outlook FindMeetingTimes operation to find available meeting times given various parameters including a semicolon separated list of attendee email addresses,
              a meeting duration (in minutes), an acceptable start and end range to find the meeting.
              Attendee emails are retrieved from the MyPeople collection. Duration and Start/End are retrieved from their respective dropdowns, where Start is set to 8:00 AM on the date selected, and End is set to 5:00 PM on the date selected.
              */
              ClearCollect(MeetingTimes, AddColumns(Office365Outlook.FindMeetingTimes(
              	{RequiredAttendees:Concat(MyPeople, UserPrincipalName & ";"), MeetingDuration:MeetingDurationSelect1.Selected.Minutes,
              	Start:Text(DateAdd(MeetingDateSelect1.SelectedDate, 8, TimeUnit.Hours), DateTimeFormat.UTC), End:Text(DateAdd(MeetingDateSelect1.SelectedDate, 17, TimeUnit.Hours), DateTimeFormat.UTC),
              	MaxCandidates:15, MinimumAttendeePercentage:1, IsOrganizerOptional: false, ActivityDomain: "Work"}).MeetingTimeSuggestions,
              StartTime, MeetingTimeSlot.Start.DateTime, EndTime, MeetingTimeSlot.End.DateTime))
              );
              UpdateContext({_loadingMeetingTimes: false});
              Set(_showMeetingTimes, true)
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            TabIndex: =0
            Tooltip: ="Select to add user to collection"
            Visible: "=!IsBlank(TextSearchBox1.Text) && \r           \r/*Is user entry a valid email address*/\rIsMatch(TextSearchBox1.Text, Match.Email) &&\r           \rNot(Trim(TextSearchBox1.Text) in MyPeople.UserPrincipalName) &&!_showDetails"
            X: =550
            Y: =TextSearchBox1.Y
      - MeetingPeopleGallery1:
          Control: Gallery@2.15.0
          Variant: SelectedUsersGalleryMeetingVariant
          Properties:
            AccessibleLabel: ="Attendees that have been added to the meeting. At least one attendee must be added."
            Height: =Min(76 * RoundUp(CountRows(Self.AllItems) / 2, 0), 350)
            Items: =MyPeople
            ShowScrollbar: =Self.Height >= 350
            TemplatePadding: =8
            Visible: =!_showDetails
            Width: =Parent.Width - Self.X * 2
            WrapCount: =2
            X: =32
            Y: =TextSearchBox1.Y + TextSearchBox1.Height
          Children:
            - Separator3:
                Control: Rectangle@2.3.0
                Properties:
                  Height: =Parent.TemplateHeight
                  OnSelect: =Select(Parent)
                  Width: =Parent.TemplateWidth
            - Title3:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =RGBA(0, 0, 0, 1)
                  Color: =App.Theme.Colors.PrimaryForeground
                  FocusedBorderThickness: =2
                  Height: =MeetingPeopleGallery1.TemplateHeight
                  OnSelect: =Set(_selectedUser, ThisItem)
                  PaddingLeft: =10
                  Size: =18 * MeetingPeopleGallery1.TemplateHeight / 60
                  TabIndex: =If(PeopleBrowseGallery1.Visible, -1, 0)
                  Text: =ThisItem.DisplayName
                  Width: =MeetingPeopleGallery1.TemplateWidth - iconRemove1.Width + 10
                  Wrap: =false
            - iconRemove1:
                Control: Classic/Icon@2.5.0
                Properties:
                  BorderColor: =Self.Color
                  Color: =Title3.Color
                  Height: =MeetingPeopleGallery1.TemplateHeight
                  Icon: =Icon.Cancel
                  OnSelect: |-
                    =Remove(MyPeople, LookUp(MyPeople, UserPrincipalName = ThisItem.UserPrincipalName));Concurrent(
                    Reset(TextSearchBox1),
                    Set(_showMeetingTimes, false),
                    UpdateContext({_loadMeetingTimes: true}),
                    Set(_selectedMeetingTime, Blank()),
                    Set(_selectedRoom, Blank()),
                    Set(_roomListSelected, false),
                    /*
                    Uses Office365 Outlook FindMeetingTimes operation to find available meeting times given various parameters including a semicolon separated list of attendee email addresses,
                    a meeting duration (in minutes), an acceptable start and end range to find the meeting.
                    Attendee emails are retrieved from the MyPeople collection. Duration and Start/End are retrieved from their respective dropdowns, where Start is set to 8:00 AM on the date selected, and End is set to 5:00 PM on the date selected.
                    */
                    ClearCollect(MeetingTimes, AddColumns(Office365Outlook.FindMeetingTimes(
                    	{RequiredAttendees:Concat(MyPeople, UserPrincipalName & ";"), MeetingDuration:MeetingDurationSelect1.Selected.Minutes,
                    	Start:Text(DateAdd(MeetingDateSelect1.SelectedDate, 8, TimeUnit.Hours), DateTimeFormat.UTC), End:Text(DateAdd(MeetingDateSelect1.SelectedDate, 17, TimeUnit.Hours), DateTimeFormat.UTC),
                    	MaxCandidates:15, MinimumAttendeePercentage:1, IsOrganizerOptional: false, ActivityDomain: "Work"}).MeetingTimeSuggestions,
                    StartTime, MeetingTimeSlot.Start.DateTime, EndTime, MeetingTimeSlot.End.DateTime))
                    );
                    UpdateContext({_loadingMeetingTimes: false});
                    Set(_showMeetingTimes, true)
                  PaddingBottom: =17 * MeetingPeopleGallery1.TemplateHeight / 60
                  PaddingLeft: =17 * MeetingPeopleGallery1.TemplateHeight / 60
                  PaddingRight: =17 * MeetingPeopleGallery1.TemplateHeight / 60
                  PaddingTop: =17 * MeetingPeopleGallery1.TemplateHeight / 60
                  TabIndex: =If(PeopleBrowseGallery1.Visible, -1, 0)
                  Tooltip: ="Select to remove user from collection"
                  Width: =Self.Height
                  X: =MeetingPeopleGallery1.TemplateWidth - Self.Width
      - LblMeetingSubject1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =50
            Text: ="*Subject"
            Visible: =!_showDetails
            Width: =300
            Wrap: =false
            X: =32
            Y: =MeetingPeopleGallery1.Y + MeetingPeopleGallery1.Height + 16
      - TextMeetingSubject1:
          Control: Classic/TextInput@2.3.2
          Properties:
            AccessibleLabel: ="A subject is required to send an email."
            Default: =""
            HintText: ="Add a subject"
            TabIndex: =If(PeopleBrowseGallery1.Visible, -1, 0)
            Visible: =!_showDetails
            Width: =Parent.Width - Self.X * 2
            X: =32
            Y: =LblMeetingSubject1.Y + LblMeetingSubject1.Height + 6
      - LblMeetingMessage1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =50
            Text: ="Message"
            Visible: =!_showDetails
            Width: =300
            Wrap: =false
            X: =32
            Y: =TextMeetingSubject1.Y + TextMeetingSubject1.Height + 16
      - TextMeetingMessage1:
          Control: Classic/TextInput@2.3.2
          Properties:
            AccessibleLabel: ="Add a message"
            Default: =""
            Height: =238
            HintText: ="Add a message"
            Mode: =TextMode.MultiLine
            TabIndex: =If(PeopleBrowseGallery1.Visible, -1, 0)
            Visible: =!_showDetails
            Width: =Parent.Width - Self.X * 2
            X: =32
            Y: =402
      - LblMeetingDate1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =40
            PaddingLeft: =0
            Text: ="*Date"
            Visible: =_showDetails
            Width: =120
            Wrap: =false
            X: =32
            Y: =RectHeaderSep1.Y + RectHeaderSep1.Height + 16
      - MeetingDateSelect1:
          Control: Classic/DatePicker@2.6.0
          Properties:
            AccessibleLabel: =Self.Tooltip
            DisplayMode: =If(IsEmpty(MyPeople), DisplayMode.Disabled, DisplayMode.Edit)
            Height: =55
            OnChange: =Select(Self)
            OnSelect: |-
              =Concurrent(
              Reset(TextSearchBox1),
              Set(_showMeetingTimes, false),
              UpdateContext({_loadingMeetingTimes: true}),
              Set(_selectedMeetingTime, Blank()),
              Set(_selectedRoom, Blank()),
              Set(_roomListSelected, false),
              /*
              Uses Office365 Outlook FindMeetingTimes operation to find available meeting times given various parameters including a semicolon separated list of attendee email addresses,
              a meeting duration (in minutes), an acceptable start and end range to find the meeting.
              Attendee emails are retrieved from the MyPeople collection. Duration and Start/End are retrieved from their respective dropdowns, where Start is set to 8:00 AM on the date selected, and End is set to 5:00 PM on the date selected.
              */
              ClearCollect(MeetingTimes, AddColumns(Office365Outlook.FindMeetingTimes(
              	{RequiredAttendees:Concat(MyPeople, UserPrincipalName & ";"), MeetingDuration:MeetingDurationSelect1.Selected.Minutes,
              	Start:Text(DateAdd(MeetingDateSelect1.SelectedDate, 8, TimeUnit.Hours), DateTimeFormat.UTC), End:Text(DateAdd(MeetingDateSelect1.SelectedDate, 17, TimeUnit.Hours), DateTimeFormat.UTC),
              	MaxCandidates:15, MinimumAttendeePercentage:1, IsOrganizerOptional: false, ActivityDomain: "Work"}).MeetingTimeSuggestions,
              StartTime, MeetingTimeSlot.Start.DateTime, EndTime, MeetingTimeSlot.End.DateTime))
              );
              UpdateContext({_loadingMeetingTimes: false});
              Set(_showMeetingTimes, true)
            Tooltip: ="Select meeting date. Required for submission."
            Visible: =_showDetails
            Width: =Parent.Width / 2 - 55.5
            X: =32
            Y: =LblMeetingDate1.Y + LblMeetingDate1.Height + 6
      - LblMeetingTime1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =40
            Size: =18
            Text: ="*Duration"
            Visible: =_showDetails
            Width: =160
            Wrap: =false
            X: =Parent.Width / 2 + 18.5
            Y: =RectHeaderSep1.Y + RectHeaderSep1.Height + 16
      - MeetingDurationSelect1:
          Control: Classic/DropDown@2.3.1
          Properties:
            AccessibleLabel: =Self.Tooltip
            DisplayMode: =If(IsEmpty(MyPeople), DisplayMode.Disabled, DisplayMode.Edit)
            Height: =55
            Items: |-
              =Table(             
              {Name:Substitute("{0} hour(s)", "{0}", "0.5"), Minutes:30},             
              {Name:Substitute("{0} hour(s)", "{0}", "1"), Minutes:60},             
              {Name:Substitute("{0} hour(s)", "{0}", "1.5"), Minutes:90},             
              {Name:Substitute("{0} hour(s)", "{0}", "2"), Minutes:120},             
              {Name:Substitute("{0} hour(s)", "{0}", "2.5"), Minutes:150},             
              {Name:Substitute("{0} hour(s)", "{0}", "3"), Minutes:180},             
              {Name:Substitute("{0} hour(s)", "{0}", "3.5"), Minutes:210},             
              {Name:Substitute("{0} hour(s)", "{0}", "4"), Minutes:240})
            Items.Value: =Name
            OnChange: =Select(MeetingDateSelect1)
            Tooltip: ="Select meeting duration. Required for submission."
            Visible: =_showDetails
            Width: =Parent.Width / 2 - 55.5
            X: =LblMeetingTime1.X
            Y: =LblMeetingTime1.Y + LblMeetingTime1.Height + 6
      - RectTimeSep1:
          Control: Rectangle@2.3.0
          Properties:
            Fill: =RGBA(240, 240, 240, 1)
            Height: =49
            Visible: =_showDetails
            Width: =Parent.Width
            Y: =MeetingDurationSelect1.Y + MeetingDurationSelect1.Height + 16
      - LblTimeHeader1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =RectTimeSep1.Height
            PaddingLeft: =0
            Size: =18
            Text: ="Time"
            Visible: =_showDetails
            Width: =Parent.Width - 37
            Wrap: =false
            X: =32
            Y: =RectTimeSep1.Y
      - iconTimesEmptyState1:
          Control: Classic/Icon@2.5.0
          Properties:
            DisplayMode: ="DisplayMode.View"
            Height: =50
            Icon: =Icon.Clock
            Visible: =( !_showMeetingTimes || CountRows(MeetingTimes) = 0 || IsEmpty(MyPeople) ) && _showDetails
            Width: =50
            X: =Parent.Width/2 - Self.Width/2
            Y: =FindMeetingTimesGallery1.Y + 81
      - LblTimesEmptyState1:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =100
            Size: =20.5
            Text: =If(_loadingMeetingTimes, "Searching for open meeting times...", !_showMeetingTimes || IsEmpty(MyPeople), "Make a selection to view available times", CountRows(MeetingTimes) = 0, "No available times on selected date")
            Visible: =( !_showMeetingTimes || CountRows(MeetingTimes) = 0 || IsEmpty(MyPeople) ) && _showDetails
            Width: =493
            X: =Parent.Width/2 - Self.Width / 2
            Y: =iconTimesEmptyState1.Y + iconTimesEmptyState1.Height + 45
      - FindMeetingTimesGallery1:
          Control: Gallery@2.15.0
          Variant: MeetingTimesGallery
          Properties:
            Height: =346
            Items: =MeetingTimes
            TemplatePadding: =0
            Visible: =_showMeetingTimes && _showDetails && !IsEmpty(MyPeople)
            Width: =Parent.Width - Self.X * 2
            X: =0
            Y: =294
          Children:
            - Separator5:
                Control: Rectangle@2.3.0
                Properties:
                  Fill: =App.Theme.Colors.Darker30
                  Height: =2
                  OnSelect: =Select(Parent)
                  Width: =FindMeetingTimesGallery1.TemplateWidth
                  Y: =102
            - Rectangle4:
                Control: Rectangle@2.3.0
                Properties:
                  BorderColor: =Title5.Color
                  BorderThickness: =If(ThisItem.StartTime = _selectedMeetingTime.StartTime, 4, 0)
                  Fill: =RGBA(0,0,0,0)
                  Height: =Parent.TemplateHeight - 4
                  HoverFill: =RGBA(0,0,0,0)
                  OnSelect: =Select(Title5)
                  Width: =Parent.TemplateWidth - 4
                  X: =2
                  Y: =2
            - Title5:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =Self.Color
                  FocusedBorderThickness: =2
                  FontWeight: =FontWeight.Semibold
                  Height: =35
                  OnSelect: |-
                    =Set(_selectedMeetingTime, ThisItem);
                    UpdateContext({_loadingRooms: true});
                    /*Collects user's tenant room lists (if any)*/
                    If(IsEmpty(RoomsLists),
                     ClearCollect(RoomsLists, Office365Outlook.GetRoomLists().value));
                    /*If tenant has no room lists, retrieves all the tenant rooms, and then retrieves their availabilities for the selected meeting time*/
                    If(CountRows(RoomsLists) <= 1,
                     Set(_noRoomLists, true);
                     ClearCollect(AllRooms, Office365Outlook.GetRooms().value);
                     Set(_allRoomsConcat, Concat(FirstN(AllRooms, 20), Address & ";"));
                     ClearCollect(RoomTimeSuggestions, Office365Outlook.FindMeetingTimes({RequiredAttendees: _allRoomsConcat, MeetingDuration: MeetingDurationSelect1.Selected.Minutes,
                       Start: _selectedMeetingTime.StartTime & "Z", End: _selectedMeetingTime.EndTime & "Z", MinimumAttendeePercentage: "1",
                       IsOrganizerOptional: "false", ActivityDomain: "Unrestricted"}).MeetingTimeSuggestions);
                     ClearCollect(AvailableRooms, AddColumns(AddColumns(Filter(First(RoomTimeSuggestions).AttendeeAvailability,
                       Availability="Free"), Address, Attendee.EmailAddress.Address), Name, LookUp(AllRooms, Address = Attendee.EmailAddress.Address).Name));
                     ClearCollect(AvailableRoomsOptimal, DropColumns(DropColumns(AvailableRooms, Availability), Attendee)),
                     Set(_roomListSelected, false));
                    UpdateContext({_loadingRooms: false})
                  Size: =18 * FindMeetingTimesGallery1.TemplateHeight / 104
                  TabIndex: =0
                  Text: =Text(DateAdd(DateTimeValue(ThisItem.StartTime), -TimeZoneOffset(), TimeUnit.Minutes), DateTimeFormat.ShortTime)
                  Width: =160
                  Wrap: =false
                  X: =37
                  Y: =5
            - Subtitle2:
                Control: Label@2.5.1
                Properties:
                  Color: =ColorFade(Title5.Color, 0.20)
                  FocusedBorderThickness: =2
                  Height: =FindMeetingTimesGallery1.TemplateHeight - Self.Y - 5
                  OnSelect: =Select(Title5)
                  Size: =18 * FindMeetingTimesGallery1.TemplateHeight / 104
                  Text: |-
                    =If(ThisItem.Confidence = 100, "All attendees available", "Unable to attend: "               
                     & Concat(Filter(ThisItem.AttendeeAvailability, Availability = "Busy" || Availability = "Oof"),               
                       LookUp(MyPeople, UserPrincipalName = Attendee.EmailAddress.Address || Mail = Attendee.EmailAddress.Address).DisplayName, ", "))
                  VerticalAlign: =VerticalAlign.Bottom
                  Width: =FindMeetingTimesGallery1.TemplateWidth - Self.X - 10
                  X: =37
                  Y: =Title5.Y + Title5.Height + 2
      - RectLocationSep1:
          Control: Rectangle@2.3.0
          Properties:
            Fill: =RGBA(240, 240, 240, 1)
            Height: =49
            Visible: =_showDetails
            Width: =Parent.Width
            Y: =591
      - LblLocationHeader1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =RectTimeSep1.Height
            PaddingLeft: =0
            Size: =18
            Text: ="Location"
            Visible: =_showDetails
            Width: =Parent.Width - Self.X
            Wrap: =false
            X: =32
            Y: =591
      - TextMeetingLocation1:
          Control: Classic/TextInput@2.3.2
          Properties:
            AccessibleLabel: ="Add a location"
            Align: =TextPosition.Left
            BorderStyle: =BorderStyle.None
            Default: =""
            DisplayMode: =If(_showDetails && !IsBlank(_selectedMeetingTime), DisplayMode.Edit, DisplayMode.Disabled)
            HintText: ="Add a location"
            PaddingLeft: =90
            Visible: =_showDetails
            Width: =Parent.Width - 2 * Self.X
            Y: =570
      - RoomSearchIcon1:
          Control: Classic/Icon@2.5.0
          Properties:
            DisplayMode: =DisplayMode.View
            Height: =Self.Width
            Icon: =Icon.Search
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            Tooltip: ="Search"
            Visible: =_showDetails
            Width: =TextMeetingLocation1.Height
            X: =14
            Y: =TextMeetingLocation1.Y
      - RectSeparator1:
          Control: Rectangle@2.3.0
          Properties:
            Fill: =RGBA(240, 240, 240, 1)
            Height: =2
            Visible: =_showDetails
            Width: =Parent.Width
            Y: =638
      - RectSeparator21:
          Control: Rectangle@2.3.0
          Properties:
            Fill: =RGBA(240, 240, 240, 1)
            Height: =2
            Visible: =_showDetails && _roomListSelected
            Width: =Parent.Width
            Y: =LblRoomListName1.Y + LblRoomListName1.Height
      - LblRoomListName1:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Color: =RGBA(71, 69, 64, 1)
            FontWeight: ="FontWeight.Semibold"
            Height: =57
            PaddingLeft: =0
            Size: =18
            Text: =_selectedRoomList
            Visible: =_showDetails && _roomListSelected
            Width: =Parent.Width - Self.X
            Wrap: =false
            X: =RoomsBackNav1.X + RoomsBackNav1.Width
            Y: =583
      - RoomsBackNav1:
          Control: Classic/Icon@2.5.0
          Properties:
            Height: =57
            Icon: =Icon.ChevronLeft
            OnSelect: =Set(_roomListSelected, false)
            PaddingBottom: =15
            PaddingLeft: =15
            PaddingRight: =15
            PaddingTop: =15
            TabIndex: =0
            Tooltip: ="return to previous list"
            Visible: =_roomListSelected && _showDetails
            Width: =57
            Y: =LblRoomListName1.Y
      - iconRoomsEmptyState1:
          Control: Classic/Icon@2.5.0
          Properties:
            DisplayMode: ="DisplayMode.View"
            Height: =50
            Icon: =Icon.Waypoint
            Visible: =Or(_showDetails && Or(IsBlank(_selectedMeetingTime), _loadingRooms), CountRows(AvailableRoomsOptimal) = 0 && Or(_noRoomLists, _roomListSelected))
            Width: =50
            X: =Parent.Width/2 - Self.Width/2
            Y: =RoomBrowseGallery1.Y + 81
      - LblRoomsEmptyState1:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 0, 0, 1)
            Height: =74
            Size: =20.5
            Text: =If(_loadingRooms, "Gathering available rooms...", IsBlank(_selectedMeetingTime), "Select a time to view available locations", CountRows(AvailableRoomsOptimal) = 0, "No rooms available at that time.")
            Visible: =Or(_showDetails && Or(IsBlank(_selectedMeetingTime), _loadingRooms), CountRows(AvailableRoomsOptimal) = 0 && Or(_noRoomLists, _roomListSelected))
            Width: =493
            X: =Parent.Width/2 - Self.Width / 2
            Y: =iconRoomsEmptyState1.Y + iconRoomsEmptyState1.Height + 45
      - RoomBrowseGallery1:
          Control: Gallery@2.15.0
          Variant: RoomsListVariant
          Properties:
            BorderColor: =App.Theme.Colors.Darker40
            Height: =Parent.Height - Self.Y
            Items: =Search(If(_roomListSelected || _noRoomLists, AvailableRoomsOptimal, RoomsLists), Trim(TextMeetingLocation1.Text), Name, Address)
            ShowScrollbar: =true
            TemplatePadding: =0
            Visible: =_showDetails && !IsBlank(_selectedMeetingTime) && !_loadingRooms
            Width: =Parent.Width - Self.X*2
            X: =0
            Y: =If(_roomListSelected, LblRoomListName1.Y + LblRoomListName1.Height, RectSeparator1.Y + RectSeparator1.Height)
          Children:
            - Rectangle10:
                Control: Rectangle@2.3.0
                Properties:
                  BorderColor: =Title6.Color
                  BorderThickness: =If(ThisItem.Address = _selectedRoom.Address, 4, 0)
                  Fill: =RGBA(0,0,0,0)
                  Height: =Parent.TemplateHeight - 4
                  HoverFill: =RGBA(0,0,0,0)
                  OnSelect: =Select(Title6)
                  Width: =Parent.TemplateWidth - 4
                  X: =2
                  Y: =2
            - Title6:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =Self.Color
                  FocusedBorderThickness: =2
                  FontWeight: =If(!_roomListSelected, FontWeight.Semibold, FontWeight.Normal)
                  Height: =40
                  OnSelect: |-
                    =/*If user is viewing room lists, then retrieves the availabilities for the rooms within that list during the selected meeting time
                    If user is viewing rooms, selects that room*/               
                    UpdateContext({_loadingRooms: true});                   
                    If(!_roomListSelected && !_noRoomLists,                   
                     Set(_roomListSelected, true);                   
                     Set(_selectedRoomList, ThisItem.Name);                   
                     ClearCollect(AllRooms, Office365Outlook.GetRoomsInRoomList(ThisItem.Address).value);                   
                     Set(_allRoomsConcat, Concat(FirstN(AllRooms, 20), Address & ";"));                   
                     ClearCollect(RoomTimeSuggestions, Office365Outlook.FindMeetingTimes({RequiredAttendees: _allRoomsConcat, MeetingDuration: MeetingDurationSelect1.Selected.Minutes,                   
                       Start: _selectedMeetingTime.StartTime & "Z", End: _selectedMeetingTime.EndTime & "Z", MinimumAttendeePercentage: "1",                   
                       IsOrganizerOptional: "false", ActivityDomain: "Unrestricted"}).MeetingTimeSuggestions);                   
                     ClearCollect(AvailableRooms, AddColumns(AddColumns(Filter(First(RoomTimeSuggestions).AttendeeAvailability, Availability = "Free"),                   
                       Address, Attendee.EmailAddress.Address), Name, LookUp(AllRooms, Address = Attendee.EmailAddress.Address).Name));                   
                     ClearCollect(AvailableRoomsOptimal, DropColumns(DropColumns(AvailableRooms, Availability), Attendee)),                   
                     Set(_selectedRoom, ThisItem)                   
                    );                   
                    UpdateContext({_loadingRooms: false})
                  Size: =18 * RoomBrowseGallery1.TemplateHeight / 104
                  TabIndex: =0
                  Text: =ThisItem.Name
                  Width: =RoomBrowseGallery1.TemplateWidth - Self.X * 2 - 50
                  Wrap: =false
                  X: =37
                  Y: =RoomBrowseGallery1.TemplateHeight / 2 - Self.Height / 2
            - iconAdd1:
                Control: Classic/Icon@2.5.0
                Properties:
                  Height: =Self.Width
                  Icon: =Icon.ChevronRight
                  OnSelect: =Select(Title6)
                  PaddingBottom: =5
                  PaddingLeft: =5
                  PaddingRight: =5
                  PaddingTop: =5
                  Visible: =!_roomListSelected && !_noRoomLists
                  Width: =64 * RoomBrowseGallery1.TemplateHeight / 150
                  X: =RoomBrowseGallery1.TemplateWidth - Self.Width - 10
                  Y: =RoomBrowseGallery1.TemplateHeight / 2 - Self.Height / 2
            - Separator6:
                Control: Rectangle@2.3.0
                Properties:
                  Fill: =App.Theme.Colors.Darker30
                  Height: =1
                  OnSelect: =Select(Parent)
                  Width: =RoomBrowseGallery1.TemplateWidth
                  Y: =RoomBrowseGallery1.TemplateHeight - Self.Height
      - PeopleBrowseGallery1:
          Control: Gallery@2.15.0
          Variant: PeoplePickerGallerySmallMeetingVariant
          Properties:
            BorderColor: =App.Theme.Colors.Darker40
            BorderThickness: =If(Len(Trim(TextSearchBox1.Text)) > 0, 2, 0)
            Fill: =TextSearchBox1.Fill
            Height: =If(Len(Trim(TextSearchBox1.Text)) > 0, Parent.Height - Self.Y - 10, 0)
            Items: |-
              =/*Only use Office 365 Users operation if user has started searching*/
              If(!IsBlank(Trim(TextSearchBox1.Text)), Office365Users.SearchUser({searchTerm: Trim(TextSearchBox1.Text), top: 15}))
            Visible: =!_showDetails && Len(Trim(TextSearchBox1.Text)) > 0
            Width: =Parent.Width - Self.X * 2
            X: =32
            Y: =TextSearchBox1.Y + TextSearchBox1.Height
          Children:
            - Rectangle11:
                Control: Rectangle@2.3.0
                Properties:
                  BorderColor: =Title7.Color
                  BorderThickness: =If(ThisItem.UserPrincipalName in MyPeople.UserPrincipalName, 4, 0)
                  Fill: =RGBA(0,0,0,0)
                  Height: =Parent.TemplateHeight
                  HoverFill: =RGBA(0,0,0,0)
                  OnSelect: =Select(Title7)
                  Width: =Parent.TemplateWidth
            - Title7:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =Self.Color
                  FocusedBorderThickness: =2
                  FontWeight: =FontWeight.Semibold
                  Height: =PeopleBrowseGallery1.TemplateHeight * 0.35
                  OnSelect: |-
                    =Concurrent(
                    Reset(TextSearchBox1),
                    Set(_selectedUser, ThisItem),
                    If(Not(ThisItem.UserPrincipalName in MyPeople.UserPrincipalName), 
                    	Collect(MyPeople, ThisItem); 
                    	Concurrent(
                    	Set(_showMeetingTimes, false),
                    	UpdateContext({_loadMeetingTimes: true}),
                    	Set(_selectedMeetingTime, Blank()),
                    	Set(_selectedRoom, Blank()),
                    	Set(_roomListSelected, false),
                    /*
                    Uses Office365 Outlook FindMeetingTimes operation to find available meeting times given various parameters including a semicolon separated list of attendee email addresses,
                    a meeting duration (in minutes), an acceptable start and end range to find the meeting.
                    Attendee emails are retrieved from the MyPeople collection. Duration and Start/End are retrieved from their respective dropdowns, where Start is set to 8:00 AM on the date selected, and End is set to 5:00 PM on the date selected.
                    */
                    	ClearCollect(MeetingTimes, AddColumns(Office365Outlook.FindMeetingTimes(
                    		{RequiredAttendees:Concat(MyPeople, UserPrincipalName & ";"), MeetingDuration:MeetingDurationSelect1.Selected.Minutes,
                    		Start:Text(DateAdd(MeetingDateSelect1.SelectedDate, 8, TimeUnit.Hours), DateTimeFormat.UTC), End:Text(DateAdd(MeetingDateSelect1.SelectedDate, 17, TimeUnit.Hours), DateTimeFormat.UTC),
                    		MaxCandidates:15, MinimumAttendeePercentage:1, IsOrganizerOptional: false, ActivityDomain: "Work"}).MeetingTimeSuggestions,
                    	StartTime, MeetingTimeSlot.Start.DateTime, EndTime, MeetingTimeSlot.End.DateTime))
                    	);
                    UpdateContext({_loadingMeetingTimes: false});
                    Set(_showMeetingTimes, true)
                    ))
                  Size: =21 * PeopleBrowseGallery1.TemplateHeight / 104
                  TabIndex: =0
                  Text: =ThisItem.DisplayName
                  Width: =PeopleBrowseGallery1.TemplateWidth - Self.X - 20
                  Wrap: =false
                  X: =16
                  Y: =0.1 * PeopleBrowseGallery1.TemplateHeight
            - Subtitle3:
                Control: Label@2.5.1
                Properties:
                  Color: =ColorFade(Title7.Color, 0.20)
                  FocusedBorderThickness: =2
                  Height: =PeopleBrowseGallery1.TemplateHeight * 0.35
                  OnSelect: =Select(Title7)
                  Size: =18 * PeopleBrowseGallery1.TemplateHeight / 104
                  Text: =ThisItem.UserPrincipalName
                  Width: =Title7.Width
                  Wrap: =false
                  X: =Title7.X
                  Y: =0.9 * PeopleBrowseGallery1.TemplateHeight - Self.Height
            - Separator7:
                Control: Rectangle@2.3.0
                Properties:
                  Fill: =App.Theme.Colors.Darker30
                  Height: =1
                  OnSelect: =Select(Parent)
                  Width: =Parent.TemplateWidth
                  Y: =Parent.TemplateHeight - 1
